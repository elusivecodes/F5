!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e:Object.assign(t,e(t))}(this,(function(t){"use strict";class e{constructor(t,e=600,s=400,i={}){this._node=t,this._context=this._node.getContext("2d"),this.reset(),Object.assign(this._settings,i),this._states=[],this._hasVertex=!1,this.resize(e,s)}applyMatrix(t,e,s,i,n,h){return this._context.transform(t,e,s,i,n,h),this}background(t){return this.push().noStroke().fill(t).rect(0,0,this.width,this.height).pop()}clear(){return this._context.clearRect(0,0,this.width,this.height),this}createShape(t=0,e=0,s=0,n=0,h=0){return new i(this._context,t,e,s,n,h)}createPath(){return new s(this._context)}drawImage(t,e=0,s=0){return this._context.drawImage(t,e,s),this}drawPath(t,e=0,s=0){const i=t.getBoundingBox(),n=t.render(this._settings);return this.drawImage(n,i.x+e,i.y+s)}drawShape(t,e=0,s=0){let{x:i,y:n}=t.getBoundingBox();const h=Math.max(this._settings.lineWidth,0);h&&(i-=h,n-=h);const o=t.render(this._settings);return this.drawImage(o,i+e,n+s)}erase(t){const e=this.createPath();return t(e),this.push(),this._context.globalCompositeOperation="destination-out",this.reset().fill("#000").drawPath(e).pop()}getImage(t,e,s,i){return this._context.getImageData(t,e,s,i)}pop(){return this._states.length&&(this._settings=this._states.pop(),this._context.restore()),this}push(){return this._states.push({...this._settings}),this._context.save(),this}putImage(t,e,s,i,n,h,o){return arguments.length>3?this._context.putImageData(t,e,s,i,n,h,o):this._context.putImageData(t,e,s),this}reset(){return this._settings={fillStyle:null,font:"sans-serif",fontSize:10,fontWeight:null,lineWidth:1,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,strokeStyle:"#000"},this.resetMatrix()}resetMatrix(){return this._context.resetTransform(),this}resize(t,e){return this.width=t,this.height=e,this._node.setAttribute("width",this.width),this._node.setAttribute("height",this.height),this}rotate(t){return this._context.rotate(t),this}scale(t,e=null){return void 0===e&&(e=t),this._context.scale(t,e),this}translate(t,e){return this._context.translate(t,e),this}}Object.assign(e.prototype,{fill(t){return this._settings.fillStyle=t,this},font(t){return this._settings.font=t,this},fontSize(t){return this._settings.fontSize=t,this},fontWeight(t){return this._settings.fontWeight=t,this},noFill(){return this._settings.fillStyle=null,this},noShadow(){return this._settings.shadowColor="rgba(0,0,0,0)",this},noStroke(){return this._settings.strokeStyle=null,this},shadow(t){return this._settings.shadowColor=t,this},shadowBlur(t){return this._settings.shadowBlur=t,this},shadowOffset(t=0,e=0){return this._settings.shadowOffsetX=t,this._settings.shadowOffsetY=e,this},stroke(t){return this._settings.strokeStyle=t,this},strokeWidth(t){return this._settings.lineWidth=t,this},text(t,e,s){this._updateContext();const i=[];return this._settings.fontWeight&&i.push(this._settings.fontWeight),i.push(this._settings.fontSize+"px"),i.push(this._settings.font),this._context.font=i.join(" "),this._context.textAlign=this._settings.textAlign,this._settings.fillStyle&&this._context.fillText(t,e,s),this._settings.strokeStyle&&this._context.strokeText(t,e,s),this},textAlign(t){return this._settings.textAlign=t,this},_draw(){this._updateContext(),this._settings.fillStyle&&this._context.fill(),this._settings.strokeStyle&&this._context.stroke()},_updateContext(){this._context.fillStyle=this._settings.fillStyle,this._context.lineWidth=this._settings.lineWidth,this._context.shadowBlur=this._settings.shadowBlur,this._context.shadowColor=this._settings.shadowColor,this._context.shadowOffsetX=this._settings.shadowOffsetX,this._context.shadowOffsetY=this._settings.shadowOffsetY,this._context.strokeStyle=this._settings.strokeStyle}}),Object.assign(e.prototype,{linearGradient(t,e,s,i){return this._context.createLinearGradient(t,e,s,i)},radialGradient(t,e,s,i,n,h){return this._context.createRadialGradient(t,e,s,i,n,h)}}),Object.assign(e.prototype,{begin(){return this._context.beginPath(),this._hasVertex=!1,this},bezierVertex(t,e,s,i,n,h){return this._context.bezierCurveTo(t,e,s,i,n,h),this},curveVertex(t,e,s,i,n){return this._context.arcTo(t,e,s,i,n),this},end(t=!1){return t&&this._context.closePath(),this._draw(),this},quadraticVertex(t,e,s,i){return this._context.quadraticCurveTo(t,e,s,i),this},vertex(t,e){return this._hasVertex?this._context.lineTo(t,e):(this._context.moveTo(t,e),this._hasVertex=!0),this}}),Object.assign(e.prototype,{arc(t,e,s,i,n){return this.begin(),this._context.arc(t,e,s,i,n),this.end()},bezier(t,e,s,i,n,h,o,r){return this.begin().vertex(t,e).bezierVertex(s,i,n,h,o,r).end()},circle(t,e,s){return this.ellipse(t,e,2*s,2*s)},curve(t,e,s,i,n,h,o){return this.begin().vertex(t,e).curveVertex(s,i,n,h,o).end()},ellipse(t,e,s,i,n=0){return this.begin(),this._context.ellipse(t,e,s/2,i/2,n,0,2*Math.PI),this.end()},line(t,e,s,i){return this.begin().vertex(t,e).vertex(s,i).end()},point(t,e){const{lineWidth:s,strokeStyle:i}=this._settings;return this.push().noStroke().fill(i).circle(t,e,s).pop()},quad(t,e,s,i,n,h,o,r){return this.begin().vertex(t,e).vertex(s,i).vertex(n,h).vertex(o,r).end(!0)},rect(t,e,s,i){return this.begin(),this._context.rect(t,e,s,i),this.end()},square(t,e,s){return this.rect(t,e,s,s)},triangle(t,e,s,i,n,h){return this.begin().vertex(t,e).vertex(s,i).vertex(n,h).end(!0)}});class s{constructor(t){this._context=t,this._path=new Path2D,this._hasVertex=!1,this._bounding={top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,left:Number.POSITIVE_INFINITY}}containsPoint(t,e){return this._context.isPointInPath(this._path,t,e)}getBoundingBox(){return{top:this._bounding.top,right:this._bounding.right,bottom:this._bounding.bottom,left:this._bounding.left,x:this._bounding.left,y:this._bounding.top,width:this._bounding.right-this._bounding.left,height:this._bounding.bottom-this._bounding.top}}render(t={}){let{width:e,height:s,x:i,y:n}=this.getBoundingBox();const h=Math.max(t.lineWidth,0);h&&(e+=2*h,s+=2*h,i-=h,n-=h);const o=document.createElement("canvas"),r=o.getContext("2d");return o.setAttribute("width",e),o.setAttribute("height",s),Object.assign(r,t),r.translate(-i,-n),t.fillStyle&&r.fill(this._path),t.strokeStyle&&r.stroke(this._path),o}_setBounds(t,e){this._bounding.top=Math.min(this._bounding.top,...e),this._bounding.right=Math.max(this._bounding.right,...t),this._bounding.bottom=Math.max(this._bounding.bottom,...e),this._bounding.left=Math.min(this._bounding.left,...t)}}Object.assign(s.prototype,{bezierVertex(t,e,s,i,n,h){return this._path.bezierCurveTo(t,e,s,i,n,h),this._setBounds([t,s,n],[e,i,h]),this},close(){return this._path.closePath(),this},curveVertex(t,e,s,i,n){return this._path.arcTo(t,e,s,i,n),this._setBounds([t,s],[e,i]),this},quadraticVertex(t,e,s,i){return this._path.quadraticCurveTo(t,e,s,i),this._setBounds([t,s],[e,i]),this},vertex(t,e){return this._hasVertex?this._path.lineTo(t,e):(this._path.moveTo(t,e),this._hasVertex=!0),this._setBounds([t],[e]),this}}),Object.assign(s.prototype,{arc(t,e,s,i,n){return this._path.arc(t,e,s,i,n),this._setBounds([t-s,t+s],[e-s,e+s]),this},bezier(t,e,s,i,n,h,o,r){return this._path.moveTo(t,e),this._path.bezierCurveTo(s,i,n,h,o,r),this._setBounds([t,s,n,o],[e,i,h,r]),this},circle(t,e,s){return this.ellipse(t,e,2*s,2*s)},curve(t,e,s,i,n,h,o){return this._path.moveTo(t,e),this._path.arcTo(s,i,n,h,o),this._setBounds([t,s,n],[e,i,h]),this},ellipse(t,e,s,i,n=0){const h=s/2,o=i/2;return this._path.ellipse(t,e,h,o,n,0,2*Math.PI),this._setBounds([t-h,t+h],[e-o,e+o]),this},line(t,e,s,i){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._setBounds([t,s],[e,i]),this},quad(t,e,s,i,n,h,o,r){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._path.lineTo(n,h),this._path.lineTo(o,r),this._path.closePath(),this._setBounds([t,s,n,o],[e,i,h,r]),this},rect(t,e,s,i){return this._path.rect(t,e,s,i),this._setBounds([t,t+s],[e,e+i]),this},square(t,e,s){return this.rect(t,e,s,s)},triangle(t,e,s,i,n,h){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._path.lineTo(n,h),this._path.closePath(),this._setBounds([t,s,n],[e,i,h]),this}});class i{constructor(t,e=0,s=0,i=0,n=0,h=0){this._context=t,this.x=e,this.y=s,this.angle=i,this.anchorX=n,this.anchorY=h,this.layers=[]}containsPoint(t,e){const s=n.create(this.x+this.anchorX,this.y+this.anchorY),i=n.create(t,e).sub(s).rotate(-this.angle).add(s);let h=!1;for(const{contour:t,path:e}of this.layers)h&&!t||!h&&t||!e.containsPoint(i.x-this.x,i.y-this.y)||(h=!h);return h}contour(t){return this.layer(t,!0)}getBoundingBox(){const t={top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,left:Number.POSITIVE_INFINITY};for(const e of this.layers){if(e.contour)continue;const s=e.path.getBoundingBox(),i=this._rotatePoint(s.right,s.top),n=this._rotatePoint(s.right,s.bottom),h=this._rotatePoint(s.left,s.bottom),o=this._rotatePoint(s.left,s.top);t.top=Math.min(t.top,i.y,n.y,h.y,o.y),t.right=Math.max(t.right,i.x,n.x,h.x,o.x),t.bottom=Math.max(t.bottom,i.y,n.y,h.y,o.y),t.left=Math.min(t.left,i.x,n.x,h.x,o.x)}return{top:t.top+this.y,right:t.right+this.x,bottom:t.bottom+this.y,left:t.left+this.x,x:t.left+this.x,y:t.top+this.y,width:t.right-t.left,height:t.bottom-t.top}}layer(t,e=!1){const i=new s(this._context);return t(i),this.layers.push({contour:e,path:i}),this}render(t={}){const e=document.createElement("canvas");if(!this.layers.length)return e;let{width:s,height:i,x:n,y:h}=this.getBoundingBox();const o=Math.max(t.lineWidth,0);o&&(s+=2*o,i+=2*o,n-=o,h-=o);const r=e.getContext("2d");e.setAttribute("width",s),e.setAttribute("height",i),r.translate(this.x-n,this.y-h),r.translate(this.anchorX,this.anchorY),r.rotate(this.angle),r.translate(-this.anchorX,-this.anchorY);for(const{contour:e,path:s}of this.layers){let i,{x:n,y:h}=s.getBoundingBox();e?(r.globalCompositeOperation="destination-out",i={...t,fillStyle:"#000"}):(r.globalCompositeOperation="source-over",i=t,o&&(n-=o,h-=o));const a=s.render(i);r.drawImage(a,n,h)}return e}_rotatePoint(t,e){const s=n.create(this.anchorX,this.anchorY);return n.create(t,e).sub(s).rotate(this.angle).add(s)}}class n{constructor(t=0,e=0){this.x=t,this.y=e}add(t,e){const s=this.constructor._parse(t,e);return this.x+=s.x,this.y+=s.y,this}angleTo(t,e){return this.constructor._parse(t,e).getHeading()-this.getHeading()}clone(){return new this.constructor(this.x,this.y)}distTo(t,e){const s=this.constructor._parse(t,e);return Math.hypot(s.x-this.x,s.y-this.y)}div(t,e){const s=this.constructor._parse(t,e);return this.x/=s.x,this.y/=s.y,this}dot(t,e){const s=this.constructor._parse(t,e);return this.x*=s.y,this.y*=s.x,this}getHeading(){return Math.atan2(this.y,this.x)}getMag(){return Math.hypot(this.x,this.y)}limit(t){return this.getMag()<=t?this:this.setMag(t)}mult(t,e){const s=this.constructor._parse(t,e);return this.x*=s.x,this.y*=s.y,this}normalize(){return this.setMag(1)}rotate(t){t+=this.getHeading();const e=this.getMag();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this}setHeading(t){const e=this.getMag();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this}setMag(t){const e=this.getHeading();return this.x=Math.cos(e)*t,this.y=Math.sin(e)*t,this}sub(t,e){const s=this.constructor._parse(t,e);return this.x-=s.x,this.y-=s.y,this}static create(t=0,e=0){return new this(t,e)}static random(){return new this(Math.random(),Math.random())}static _parse(t=0,e=0){return t instanceof n?t:new n(t,e)}}return{Canvas:class{constructor(s,i=600,n=400){this._node=s,this._loop=!0,this._mouseX=null,this._mouseY=null,this._mouseDown={},this._keysDown={},this.context=new e(this._node,i,n),this._node.setAttribute("tabindex","1"),this._node.style.setProperty("outline","0"),this._events(),this.setup();const h=Date.now(),o=e=>{const s=(Date.now()-h)/1e3;this.update(s),this._loop&&t.requestAnimationFrame(o)};o()}isKeyPressed(t){return t?t in this._keysDown:Object.keys(this._keysDown).length}isMousePressed(t=0){return t in this._mouseDown&&null!==this._mouseX&&null!==this._mouseY}mousePos(){return null===this._mouseX||null===this._mouseY?null:new n(this._mouseX,this._mouseY)}noLoop(){this._loop=!1}onKeyDown(t,e){}onKeyPress(t,e){}onKeyUp(t,e){}onMouseClick(t,e){}onMouseDown(t,e){}onMouseEnter(t){}onMouseLeave(t){}onMouseMove(t,e,s){}onMouseUp(t,e){}setup(){}update(){}_events(){const e=t=>{this._mouseX=t.offsetX,this._mouseY=t.offsetY};this._node.addEventListener("mouseenter",t=>{e(t),this.onMouseEnter(t)}),this._node.addEventListener("mouseleave",t=>{e(t),this.onMouseLeave(t),this._mouseX=null,this._mouseY=null}),this._node.addEventListener("mousemove",t=>{e(t),this.onMouseMove(this._mouseX,this._mouseY,t)}),this._node.addEventListener("mousedown",s=>{this._mouseDown[s.button]=!0,e(s),this.onMouseDown(s.button,s),t.addEventListener("mouseup",t=>{delete this._mouseDown[t.button],e(t),this.onMouseUp(t.button,t)},{once:!0})}),this._node.addEventListener("click",t=>{e(t),this.onMouseClick(t.button,t)}),this._node.addEventListener("keydown",e=>{this._keysDown[e.code]=!0,this.onKeyDown(e.code,e),t.addEventListener("keyup",t=>{delete this._keysDown[t.code],this.onKeyUp(t.code,t)},{once:!0})}),this._node.addEventListener("keypress",t=>{this.onKeyPress(t.code,t)})}static attach(t=document.body,e=600,s=400){const i=document.createElement("canvas");return t.append(i),new this(i,e,s)}},CanvasContext:e,Path:s,Shape:i,Vector:n}}));
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).F5={})}(this,(function(t){"use strict";class e{constructor(t){this._context=t,this._path=new Path2D,this._hasVertex=!1,this._bounding={top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,left:Number.POSITIVE_INFINITY}}containsPoint(t,e){return this._context.isPointInPath(this._path,t,e)}getBoundingBox(){return{top:this._bounding.top,right:this._bounding.right,bottom:this._bounding.bottom,left:this._bounding.left,x:this._bounding.left,y:this._bounding.top,width:this._bounding.right-this._bounding.left,height:this._bounding.bottom-this._bounding.top}}render(t={}){let{width:e,height:s,x:i,y:n}=this.getBoundingBox();const o=Math.max(t.lineWidth,0);o&&(e+=2*o,s+=2*o,i-=o,n-=o);const h=document.createElement("canvas"),r=h.getContext("2d");return h.setAttribute("width",e),h.setAttribute("height",s),Object.assign(r,t),r.translate(-i,-n),t.fillStyle&&r.fill(this._path),t.strokeStyle&&r.stroke(this._path),h}_setBounds(t,e){this._bounding.top=Math.min(this._bounding.top,...e),this._bounding.right=Math.max(this._bounding.right,...t),this._bounding.bottom=Math.max(this._bounding.bottom,...e),this._bounding.left=Math.min(this._bounding.left,...t)}}function s(t,e){return t instanceof i?t:new i(t,e)}class i{constructor(t=0,e=0){this.x=t,this.y=e}add(t,e){const i=s(t,e);return this.x+=i.x,this.y+=i.y,this}angleTo(t,e){return s(t,e).getHeading()-this.getHeading()}clone(){return new this.constructor(this.x,this.y)}distTo(t,e){const i=s(t,e);return Math.hypot(i.x-this.x,i.y-this.y)}div(t,e){const i=s(t,e);return this.x/=i.x,this.y/=i.y,this}dot(t,e){const i=s(t,e);return this.x*=i.y,this.y*=i.x,this}getHeading(){return Math.atan2(this.y,this.x)}getMag(){return Math.hypot(this.x,this.y)}limit(t){return this.getMag()<=t?this:this.setMag(t)}mult(t,e){const i=s(t,e);return this.x*=i.x,this.y*=i.y,this}normalize(){return this.setMag(1)}rotate(t){t+=this.getHeading();const e=this.getMag();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this}setHeading(t){const e=this.getMag();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this}setMag(t){const e=this.getHeading();return this.x=Math.cos(e)*t,this.y=Math.sin(e)*t,this}sub(t,e){const i=s(t,e);return this.x-=i.x,this.y-=i.y,this}static create(t=0,e=0){return new this(t,e)}static random(){return new this(Math.random(),Math.random())}}class n{constructor(t,e=0,s=0,i=0,n=0,o=0){this._context=t,this.x=e,this.y=s,this.angle=i,this.anchorX=n,this.anchorY=o,this.layers=[]}containsPoint(t,e){const s=i.create(this.x+this.anchorX,this.y+this.anchorY),n=i.create(t,e).sub(s).rotate(-this.angle).add(s);let o=!1;for(const{contour:t,path:e}of this.layers)o&&!t||!o&&t||!e.containsPoint(n.x-this.x,n.y-this.y)||(o=!o);return o}contour(t){return this.layer(t,!0)}getBoundingBox(){const t={top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,left:Number.POSITIVE_INFINITY};for(const e of this.layers){if(e.contour)continue;const s=e.path.getBoundingBox(),i=this._rotatePoint(s.right,s.top),n=this._rotatePoint(s.right,s.bottom),o=this._rotatePoint(s.left,s.bottom),h=this._rotatePoint(s.left,s.top);t.top=Math.min(t.top,i.y,n.y,o.y,h.y),t.right=Math.max(t.right,i.x,n.x,o.x,h.x),t.bottom=Math.max(t.bottom,i.y,n.y,o.y,h.y),t.left=Math.min(t.left,i.x,n.x,o.x,h.x)}return{top:t.top+this.y,right:t.right+this.x,bottom:t.bottom+this.y,left:t.left+this.x,x:t.left+this.x,y:t.top+this.y,width:t.right-t.left,height:t.bottom-t.top}}layer(t,s=!1){const i=new e(this._context);return t(i),this.layers.push({contour:s,path:i}),this}render(t={}){const e=document.createElement("canvas");if(!this.layers.length)return e;let{width:s,height:i,x:n,y:o}=this.getBoundingBox();const h=Math.max(t.lineWidth,0);h&&(s+=2*h,i+=2*h,n-=h,o-=h);const r=e.getContext("2d");e.setAttribute("width",s),e.setAttribute("height",i),r.translate(this.x-n,this.y-o),r.translate(this.anchorX,this.anchorY),r.rotate(this.angle),r.translate(-this.anchorX,-this.anchorY);for(const{contour:e,path:s}of this.layers){let i,{x:n,y:o}=s.getBoundingBox();e?(r.globalCompositeOperation="destination-out",i={...t,fillStyle:"#000"}):(r.globalCompositeOperation="source-over",i=t,h&&(n-=h,o-=h));const u=s.render(i);r.drawImage(u,n,o)}return e}_rotatePoint(t,e){const s=i.create(this.anchorX,this.anchorY);return i.create(t,e).sub(s).rotate(this.angle).add(s)}}class o{constructor(t,e=600,s=400,i={}){this._node=t,this._context=this._node.getContext("2d"),this._options={...this.constructor.defaults,options:i},this._states=[],this._hasVertex=!1,this.resize(e,s)}applyMatrix(t,e,s,i,n,o){return this._context.transform(t,e,s,i,n,o),this}background(t){return this.push().noStroke().fill(t).rect(0,0,this.width,this.height).pop()}clear(){return this._context.clearRect(0,0,this.width,this.height),this}createShape(t=0,e=0,s=0,i=0,o=0){return new n(this._context,t,e,s,i,o)}createPath(){return new e(this._context)}drawImage(t,e=0,s=0){return this._context.drawImage(t,e,s),this}drawPath(t,e=0,s=0){const i=t.getBoundingBox(),n=t.render(this._options);return this.drawImage(n,i.x+e,i.y+s)}drawShape(t,e=0,s=0){let{x:i,y:n}=t.getBoundingBox();const o=Math.max(this._options.lineWidth,0);o&&(i-=o,n-=o);const h=t.render(this._options);return this.drawImage(h,i+e,n+s)}erase(t){const e=this.createPath();return t(e),this.push(),this._context.globalCompositeOperation="destination-out",this.reset().fill("#000").drawPath(e).pop()}getImage(t,e,s,i){return this._context.getImageData(t,e,s,i)}pop(){return this._states.length&&(this._options=this._states.pop(),this._context.restore()),this}push(){return this._states.push({...this._options}),this._context.save(),this}putImage(t,e,s,i,n,o,h){return arguments.length>3?this._context.putImageData(t,e,s,i,n,o,h):this._context.putImageData(t,e,s),this}reset(){return this._options=this.constructor.defaults,this.resetMatrix()}resetMatrix(){return this._context.resetTransform(),this}resize(t,e){return this.width=t,this.height=e,this._node.setAttribute("width",this.width),this._node.setAttribute("height",this.height),this}rotate(t){return this._context.rotate(t),this}scale(t,e=null){return void 0===e&&(e=t),this._context.scale(t,e),this}translate(t,e){return this._context.translate(t,e),this}}o.defaults={fillStyle:null,font:"sans-serif",fontSize:10,fontWeight:null,lineWidth:1,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,strokeStyle:"#000"};const h=o.prototype;h.arc=function(t,e,s,i,n){return this.begin(),this._context.arc(t,e,s,i,n),this.end()},h.begin=function(){return this._context.beginPath(),this._hasVertex=!1,this},h.bezier=function(t,e,s,i,n,o,h,r){return this.begin().vertex(t,e).bezierVertex(s,i,n,o,h,r).end()},h.bezierVertex=function(t,e,s,i,n,o){return this._context.bezierCurveTo(t,e,s,i,n,o),this},h.circle=function(t,e,s){return this.ellipse(t,e,2*s,2*s)},h.curve=function(t,e,s,i,n,o,h){return this.begin().vertex(t,e).curveVertex(s,i,n,o,h).end()},h.curveVertex=function(t,e,s,i,n){return this._context.arcTo(t,e,s,i,n),this},h.ellipse=function(t,e,s,i,n=0){return this.begin(),this._context.ellipse(t,e,s/2,i/2,n,0,2*Math.PI),this.end()},h.end=function(t=!1){return t&&this._context.closePath(),this._draw(),this},h.fill=function(t){return this._options.fillStyle=t,this},h.font=function(t){return this._options.font=t,this},h.fontSize=function(t){return this._options.fontSize=t,this},h.fontWeight=function(t){return this._options.fontWeight=t,this},h.line=function(t,e,s,i){return this.begin().vertex(t,e).vertex(s,i).end()},h.linearGradient=function(t,e,s,i){return this._context.createLinearGradient(t,e,s,i)},h.noFill=function(){return this._options.fillStyle=null,this},h.noShadow=function(){return this._options.shadowColor="rgba(0,0,0,0)",this},h.noStroke=function(){return this._options.strokeStyle=null,this},h.point=function(t,e){const{lineWidth:s,strokeStyle:i}=this._options;return this.push().noStroke().fill(i).circle(t,e,s).pop()},h.quad=function(t,e,s,i,n,o,h,r){return this.begin().vertex(t,e).vertex(s,i).vertex(n,o).vertex(h,r).end(!0)},h.quadraticVertex=function(t,e,s,i){return this._context.quadraticCurveTo(t,e,s,i),this},h.radialGradient=function(t,e,s,i,n,o){return this._context.createRadialGradient(t,e,s,i,n,o)},h.rect=function(t,e,s,i){return this.begin(),this._context.rect(t,e,s,i),this.end()},h.shadow=function(t){return this._options.shadowColor=t,this},h.shadowBlur=function(t){return this._options.shadowBlur=t,this},h.shadowOffset=function(t=0,e=0){return this._options.shadowOffsetX=t,this._options.shadowOffsetY=e,this},h.square=function(t,e,s){return this.rect(t,e,s,s)},h.stroke=function(t){return this._options.strokeStyle=t,this},h.strokeWidth=function(t){return this._options.lineWidth=t,this},h.text=function(t,e,s){this._updateContext();const i=[];return this._options.fontWeight&&i.push(this._options.fontWeight),i.push(`${this._options.fontSize}px`),i.push(this._options.font),this._context.font=i.join(" "),this._context.textAlign=this._options.textAlign,this._options.fillStyle&&this._context.fillText(t,e,s),this._options.strokeStyle&&this._context.strokeText(t,e,s),this},h.textAlign=function(t){return this._options.textAlign=t,this},h.triangle=function(t,e,s,i,n,o){return this.begin().vertex(t,e).vertex(s,i).vertex(n,o).end(!0)},h.vertex=function(t,e){return this._hasVertex?this._context.lineTo(t,e):(this._context.moveTo(t,e),this._hasVertex=!0),this},h._draw=function(){this._updateContext(),this._options.fillStyle&&this._context.fill(),this._options.strokeStyle&&this._context.stroke()},h._updateContext=function(){this._context.fillStyle=this._options.fillStyle,this._context.lineWidth=this._options.lineWidth,this._context.shadowBlur=this._options.shadowBlur,this._context.shadowColor=this._options.shadowColor,this._context.shadowOffsetX=this._options.shadowOffsetX,this._context.shadowOffsetY=this._options.shadowOffsetY,this._context.strokeStyle=this._options.strokeStyle};const r=e.prototype;r.arc=function(t,e,s,i,n){return this._path.arc(t,e,s,i,n),this._setBounds([t-s,t+s],[e-s,e+s]),this},r.bezier=function(t,e,s,i,n,o,h,r){return this._path.moveTo(t,e),this._path.bezierCurveTo(s,i,n,o,h,r),this._setBounds([t,s,n,h],[e,i,o,r]),this},r.bezierVertex=function(t,e,s,i,n,o){return this._path.bezierCurveTo(t,e,s,i,n,o),this._setBounds([t,s,n],[e,i,o]),this},r.circle=function(t,e,s){return this.ellipse(t,e,2*s,2*s)},r.close=function(){return this._path.closePath(),this},r.curve=function(t,e,s,i,n,o,h){return this._path.moveTo(t,e),this._path.arcTo(s,i,n,o,h),this._setBounds([t,s,n],[e,i,o]),this},r.curveVertex=function(t,e,s,i,n){return this._path.arcTo(t,e,s,i,n),this._setBounds([t,s],[e,i]),this},r.ellipse=function(t,e,s,i,n=0){const o=s/2,h=i/2;return this._path.ellipse(t,e,o,h,n,0,2*Math.PI),this._setBounds([t-o,t+o],[e-h,e+h]),this},r.line=function(t,e,s,i){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._setBounds([t,s],[e,i]),this},r.quad=function(t,e,s,i,n,o,h,r){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._path.lineTo(n,o),this._path.lineTo(h,r),this._path.closePath(),this._setBounds([t,s,n,h],[e,i,o,r]),this},r.quadraticVertex=function(t,e,s,i){return this._path.quadraticCurveTo(t,e,s,i),this._setBounds([t,s],[e,i]),this},r.rect=function(t,e,s,i){return this._path.rect(t,e,s,i),this._setBounds([t,t+s],[e,e+i]),this},r.square=function(t,e,s){return this.rect(t,e,s,s)},r.triangle=function(t,e,s,i,n,o){return this._path.moveTo(t,e),this._path.lineTo(s,i),this._path.lineTo(n,o),this._path.closePath(),this._setBounds([t,s,n],[e,i,o]),this},r.vertex=function(t,e){return this._hasVertex?this._path.lineTo(t,e):(this._path.moveTo(t,e),this._hasVertex=!0),this._setBounds([t],[e]),this},t.Canvas=class{constructor(t,e=600,s=400){this._node=t,this._loop=!0,this._mouseX=null,this._mouseY=null,this._mouseDown={},this._keysDown={},this.context=new o(this._node,e,s),this._node.setAttribute("tabindex","1"),this._node.style.setProperty("outline","0"),this._events(),this.setup();const i=Date.now(),n=t=>{const e=(Date.now()-i)/1e3;this.update(e),this._loop&&window.requestAnimationFrame(n)};n()}isKeyPressed(t){return t?t in this._keysDown:Object.keys(this._keysDown).length}isMousePressed(t=0){return t in this._mouseDown&&null!==this._mouseX&&null!==this._mouseY}mousePos(){return null===this._mouseX||null===this._mouseY?null:new i(this._mouseX,this._mouseY)}noLoop(){this._loop=!1}onKeyDown(){}onKeyPress(){}onKeyUp(){}onMouseClick(){}onMouseDown(){}onMouseEnter(){}onMouseLeave(){}onMouseMove(){}onMouseUp(){}setup(){}update(){}_events(){const t=t=>{this._mouseX=t.offsetX,this._mouseY=t.offsetY};this._node.addEventListener("mouseenter",(e=>{t(e),this.onMouseEnter(e)})),this._node.addEventListener("mouseleave",(e=>{t(e),this.onMouseLeave(e),this._mouseX=null,this._mouseY=null})),this._node.addEventListener("mousemove",(e=>{t(e),this.onMouseMove(this._mouseX,this._mouseY,e)})),this._node.addEventListener("mousedown",(e=>{this._mouseDown[e.button]=!0,t(e),this.onMouseDown(e.button,e),window.addEventListener("mouseup",(e=>{delete this._mouseDown[e.button],t(e),this.onMouseUp(e.button,e)}),{once:!0})})),this._node.addEventListener("click",(e=>{t(e),this.onMouseClick(e.button,e)})),this._node.addEventListener("keydown",(t=>{this._keysDown[t.code]=!0,this.onKeyDown(t.code,t),window.addEventListener("keyup",(t=>{delete this._keysDown[t.code],this.onKeyUp(t.code,t)}),{once:!0})})),this._node.addEventListener("keypress",(t=>{this.onKeyPress(t.code,t)}))}static attach(t=document.body,e=600,s=400){const i=document.createElement("canvas");return t.append(i),new this(i,e,s)}},t.CanvasContext=o,t.Path=e,t.Shape=n,t.Vector=i}));